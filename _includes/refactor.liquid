<!-- Refactor the HTML structure -->

{% assign _content = include.content %}

{% if _content contains '<pre class="highlight">' %}
  {% assign _content = _content
    | replace: '<div class="highlight"><pre class="highlight"><code', '<div class="highlight"><code'
    | replace: '</code></pre>
</div>', '</code></div>'
  %}
{% endif %}

<!-- Add header for code snippets -->

{% if _content contains '<div class="highlight"><code>' %}
  {% assign _code_spippets = _content | split: '<div class="highlight"><code>' %}
  {% assign _new_content = '' %}

  {% for _snippet in _code_spippets %}
    {% if forloop.last %}
      {% assign _new_content = _new_content | append: _snippet %}

    {% else %}
      {% assign _left = _snippet | split: '><' | last %}

      {% if _left %}
        {% assign _lang = _left | split: 'language-' | last | split: ' ' | first %}
      {% endif %}
      {% if _lang != 'md' %}
        {% capture _codepen_btn %}<button class="code-codepen">âœï¸</button>{% endcapture %}
      {% endif %}
      {% assign _new_content = _new_content
        | append: _snippet
        | append: '<div class="code-header">'
        | append: _codepen_btn
        | append: '<button class="code-copy" aria-label="copy" data-title-succeed="'
        | append: '">ğŸ“‹</button></div>'
        | append: '<div class="highlight"><code>'
      %}
    {% endif %}
  {% endfor %}

  {% assign _content = _new_content %}
{% endif %}

<!-- return -->
{{ _content }}
